version: v1.0
name: Toolbox S2 project
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: Run Tests
    task:
      jobs:
      - name: Cache tests
        commands:
          - checkout
          - cd ../
          - rm -rf .toolbox/
          - mv toolbox/ .toolbox
          - bash .toolbox/install-toolbox
          - source .toolbox/toolbox
          - export SEMAPHORE_GIT_URL="https://github.com/rails/rails.git"
          - export SEMAPHORE_GIT_BRANCH=master
          - export SEMAPHORE_GIT_DIR=rails
          - export SEMAPHORE_GIT_SHA=f907b418aecfb6dab4e30149b88a8593ddd321b9
          - checkout
          - cd
          - cache store git-cache-$RANDOM rails
          - export SEMAPHORE_GIT_BRANCH=5-0-stable
          - cache list
          - rm -rf rails
          - checkout --use-cache
